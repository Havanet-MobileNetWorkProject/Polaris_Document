\documentclass{report}
\usepackage{ptext}
\usepackage{lipsum}
\usepackage{graphicx}
\usepackage{ptext}

\input{Boostan-UserManual}

\input{Chapters/BWords}
\input{Chapters/abbre}

\title{گزارش پروژه نهایی درس شبکه های تلفن همراه}
\type{گزارش }
\author{زهرا دهقان\\اسماء حمید\\فاطمه شرح دهی مقدم}

\logofile{Pic/logo}


\begin{document}

\pagenumbering{gobble}
\Godpage
\maketitle
\pagenumbering{arabic}
\tableofcontents


\chapter{مقدمه}








\chapter{ \lr{Polaris Server}}

\section{Authentication}

\subsection{\lr{Register API} (ثبت‌نام کاربر)}
\textbf{مدل (User Model)} \\
مدل کاربر برای سامانه Polaris به شکل زیر طراحی شده است:

\begin{itemize}
  \item \lr{phone}: شماره تلفن کاربر (یونیک و به‌عنوان نام کاربری استفاده می‌شود).
  \item \lr{role}: نقش کاربر که می‌تواند \lr{user} یا \lr{admin} باشد (پیش‌فرض: \lr{user}).
  \item \lr{is\_active}: تعیین فعال بودن کاربر.
  \item \lr{is\_staff}: برای تشخیص دسترسی مدیریتی.
\end{itemize}

کاربران عادی نقش \lr{user} دارند و مدیران (\lr{superuser}) نقش \lr{admin}. \\
همچنین یک \lr{UserManager} پیاده‌سازی شده تا:
\begin{itemize}
  \item تابع \lr{create\_user}: کاربر عادی بسازد.
  \item تابع \lr{create\_superuser}: ادمین بسازد.
\end{itemize}
\begin{lstlisting}[language=python]
class UserManager(BaseUserManager):
    def create_user(self, phone, password=None, **extra_fields):
        if not phone:
            raise ValueError("Phone number is required")
        user = self.model(phone=phone, **extra_fields)
        user.set_password(password)
        user.save(using=self._db)
        return user

    def create_superuser(self, phone, password=None, **extra_fields):
        extra_fields.setdefault('is_staff', True)
        extra_fields.setdefault('is_superuser', True)
        extra_fields.setdefault('role', 'admin')
        return self.create_user(phone, password, **extra_fields)

class User(AbstractBaseUser, PermissionsMixin):
    ROLE_CHOICES = (
        ('user', 'User'),
        ('admin', 'Admin'),
    )

    phone = models.CharField(max_length=15, unique=True)
    role = models.CharField(max_length=10, choices=ROLE_CHOICES, default='user')
    is_active = models.BooleanField(default=True)
    is_staff = models.BooleanField(default=False)

    objects = UserManager()

    USERNAME_FIELD = 'phone'
    REQUIRED_FIELDS = []

    def __str__(self):
        return self.phone

\end{lstlisting}
\textbf{Serializer (RegisterSerializer)} \\
کلاس \lr{RegisterSerializer} برای اعتبارسنجی داده‌های ورودی ثبت‌نام استفاده می‌شود:
\begin{itemize}
  \item فقط دو فیلد دریافت می‌کند: \lr{phone} و \lr{password}.
  \item \lr{password} فقط نوشتنی (\lr{write\_only}) است.
  \item تابع \lr{create}: از متد \lr{create\_user} در \lr{UserManager} استفاده می‌کند.
\end{itemize}

\textbf{View (RegisterView)} \\
کلاس \lr{RegisterView} یک \lr{APIView} است که درخواست‌های POST را پردازش می‌کند:
\begin{itemize}
  \item داده‌های ورودی توسط \lr{RegisterSerializer} بررسی می‌شود.
  \item اگر معتبر بود: کاربر ساخته می‌شود و توکن‌های JWT صادر می‌گردد.
  \item خروجی شامل توکن‌ها + اطلاعات کاربر است.
\end{itemize}

\textbf{ورودی (POST /auth/signup/)}:
\begin{lstlisting}[language=json]
{
  "phone": "09123456789",
  "password": "test1234"
}
\end{lstlisting}

\textbf{خروجی موفق (201)}:
\begin{lstlisting}[language=json]
{
  "refresh": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1...",
  "access": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1...",
  "user": {
    "id": 1,
    "phone": "09123456789",
    "role": "user"
  }
}
\end{lstlisting}

\textbf{خروجی ناموفق (400)}:
\begin{lstlisting}[language=json]
{
  "phone": ["This field must be unique."]
}
\end{lstlisting}
\subsubsection{Post-Save Signal (ایجاد آستانه‌های پیش‌فرض بعد از ثبت‌نام)}

پس از ثبت‌نام هر کاربر جدید، یک سیگنال \lr{post\_save} در جنگو اجرا می‌شود. این سیگنال باعث می‌شود که به‌طور خودکار مجموعه‌ای از \lr{ThresholdParameter} و \lr{ThresholdLevel} برای کاربر ایجاد گردد.

\textbf{کلیت Threshold} \\
جزئیات کامل ساختار و کاربرد \lr{Threshold}ها در فصل مربوط به Thresholds توضیح داده خواهد شد. 
در این بخش تنها نحوه‌ی ایجاد پیش‌فرض‌ها هنگام ثبت‌نام بیان می‌شود.

\textbf{Signal (create\_default\_thresholds)} \\
این تابع سیگنال پس از ذخیره‌ی یک کاربر (\lr{User}) اجرا می‌شود:
\begin{itemize}
  \item بررسی می‌کند که آیا کاربر تازه ساخته شده است و نقش او \lr{user} باشد.
  \item اگر درست باشد، بر اساس \lr{default\_thresholds} برای هر فناوری (\lr{2G}, \lr{3G}, \lr{4G}, \lr{5G}) پارامترها ساخته می‌شوند.
  \item برای هر پارامتر چندین سطح (\lr{ThresholdLevel}) با بازه مقادیر و رنگ مشخص ایجاد می‌شود.
\end{itemize}

\textbf{کد سیگنال (نمونه)}:
\begin{lstlisting}[language=python]
@receiver(post_save, sender=User)
def create_default_thresholds(sender, instance, created, **kwargs):
    if created and instance.role == "user":
        for tech, params in default_thresholds.items():
            for p in params:
                param = ThresholdParameter.objects.create(
                    user=instance,
                    name=p["name"],
                    technology=tech,
                    signal_type=p["signal_type"],
                )
                for lvl in p["levels"]:
                    ThresholdLevel.objects.create(
                        parameter=param,
                        level=lvl["level"],
                        color=lvl["color"],
                        min_value=lvl["min"],
                        max_value=lvl["max"],
                    )
\end{lstlisting}

\textbf{مقادیر پیش‌فرض (\lr{default\_thresholds})} \\
این مقادیر برای هر فناوری از قبل تعریف شده‌اند.

\textbf{نمونه برای 2G}:
\begin{lstlisting}[language=json]
"2G": [
  {
    "name": "rxlev",
    "signal_type": "quantity",
    "levels": [
      {"level": 1, "color": "#FF0000", "min": -110, "max": -100},
      {"level": 2, "color": "#FFFF00", "min": -100, "max": -80},
      {"level": 3, "color": "#008000", "min": -80, "max": -50}
    ]
  }
]
\end{lstlisting}

برای سایر فناوری‌ها (\lr{3G}، \lr{4G}، \lr{5G}) نیز پارامترهایی مانند \lr{rscp}، \lr{rsrp} و \lr{rsrq} تعریف شده‌اند که هرکدام دارای سطوح رنگی مختلف هستند. 

به این ترتیب، هر کاربر جدید بلافاصله پس از ثبت‌نام، یک مجموعه‌ی اولیه از آستانه‌های سنجش کیفیت و کمیت سیگنال را در اختیار خواهد داشت.



\subsection{Login API (ورود کاربر)}
\textbf{View (LoginView)} \\
\begin{itemize}
  \item درخواست POST می‌گیرد.
  \item شماره تلفن و رمز عبور را بررسی می‌کند.
  \item در صورت معتبر بودن، توکن‌های JWT صادر می‌کند.
  \item اطلاعات کاربر بازگردانده می‌شود.
\end{itemize}

\textbf{ورودی (POST /auth/login/)}:
\begin{lstlisting}[language=json]
{
  "phone": "09123456789",
  "password": "test1234"
}
\end{lstlisting}

\textbf{خروجی موفق (200)}:
\begin{lstlisting}[language=json]
{
  "refresh": "eyJ0eXAiOiJKV1QiLCJh...",
  "access": "eyJ0eXAiOiJKV1QiLCJh...",
  "user": {
    "id": 1,
    "phone": "09123456789",
    "role": "user"
  }
}
\end{lstlisting}

\textbf{خروجی ناموفق (401)}:
\begin{lstlisting}[language=json]
{
  "error": "Invalid credentials"
}
\end{lstlisting}


\subsection{Logout API (خروج کاربر)}
\textbf{View (LogoutView)} \\
\begin{itemize}
  \item درخواست POST دریافت می‌کند.
  \item کاربر باید توکن \lr{refresh} را ارسال کند.
  \item توکن بلاک‌لیست می‌شود.
\end{itemize}

\textbf{ورودی (POST /auth/logout/)}:
\begin{lstlisting}[language=json]
{
  "refresh": "eyJ0eXAiOiJKV1QiLCJh..."
}
\end{lstlisting}

\textbf{خروجی موفق (205)}: (بدون بدنه) \\
\textbf{خروجی ناموفق (400)}: (بدون بدنه)


\subsection{Profile API (نمایه کاربر)}
\textbf{Serializer (UserSerializer)} \\
برای نمایش اطلاعات کاربر از \lr{UserSerializer} استفاده می‌شود (شامل \lr{id}, \lr{phone}, \lr{role}).

\textbf{View (ProfileView)} \\
\begin{itemize}
  \item درخواست GET دریافت می‌کند.
  \item نیاز به احراز هویت دارد.
  \item اطلاعات کاربر لاگین‌شده بازگردانده می‌شود.
\end{itemize}

\textbf{ورودی (GET /auth/profile/)}: بدون بدنه (توکن در Header). \\

\textbf{خروجی موفق (200)}:
\begin{lstlisting}[language=json]
{
  "id": 1,
  "phone": "09123456789",
  "role": "user"
}
\end{lstlisting}

\textbf{خروجی ناموفق (401)}:
\begin{lstlisting}[language=json]
{
  "detail": "Authentication credentials were not provided."
}
\end{lstlisting}

\section{CellInfo API}
برای ثبت و دریافت اطلاعات سیگنال سلولی کاربران طراحی شده است. این API انواع شبکه‌ها را پشتیبانی می‌کند: 2G, 3G, 4G, 5G. کاربران باید احراز هویت شده باشند (\texttt{IsAuthenticated}) تا بتوانند داده‌ها را ارسال یا دریافت کنند.

\section{دسته‌بندی کاربران}
\begin{itemize}
    \item \textbf{کاربران عادی:} فقط داده‌های خودشان را می‌بینند.
    \item \textbf{ادمین‌ها:} می‌توانند داده همه کاربران را مشاهده کنند و در صورت نیاز با پارامتر \texttt{client\_id} فیلتر کنند.
    \item \textbf{Pagination:} \texttt{GET} شامل تعداد کل، تعداد صفحات، صفحه جاری و نتایج است.
\end{itemize}

\section{مدل‌ها}
تمام مدل‌ها از \texttt{BaseSignalTest} ارث‌بری می‌کنند.

\subsection{BaseSignalTest}
\begin{itemize}
    \item \texttt{timestamp (DateTimeField)}: زمان ثبت سیگنال
    \item \texttt{technology (CharField)}: نوع تکنولوژی سلولی. گزینه‌ها: 'GSM', 'GPRS', 'EDGE', 'UMTS', 'HSPA', 'HSPA+', 'LTE', 'LTE-Adv', '5G'
    \item \texttt{latitude} و \texttt{longitude (FloatField)}: موقعیت جغرافیایی سیگنال
    \item \texttt{plmn\_id (CharField)}: شناسه شبکه تلفن همراه
    \item \texttt{cell\_id (BigIntegerField)}: شناسه سلول
    \item \texttt{arfcn (IntegerField, optional)}: فرکانس رادیویی
    \item \texttt{band (IntegerField, optional)}: باند فرکانسی
\end{itemize}

\subsubsection{Property Generation}
\begin{itemize}
    \item \textbf{2G:} GSM, GPRS, EDGE
    \item \textbf{3G:} UMTS, HSPA, HSPA+
    \item \textbf{4G:} LTE, LTE-Adv
    \item \textbf{5G:} 5G
    \item \textbf{Unknown:} سایر مقادیر
\end{itemize}

\subsection{مدل‌های اختصاصی هر نسل}

\subsubsection{SignalTest2G}
\begin{itemize}
    \item ارث‌بری از \texttt{BaseSignalTest}
    \item \texttt{user (ForeignKey → User)}: کاربر ثبت‌کننده
    \item \texttt{lac (IntegerField)}: کد منطقه سلولی
    \item \texttt{rxlev (FloatField, optional)}: قدرت سیگنال
\end{itemize}

\subsubsection{SignalTest3G}
\begin{itemize}
    \item \texttt{user (ForeignKey → User)}
    \item \texttt{lac (IntegerField)}
    \item \texttt{rscp (FloatField)}: قدرت سیگنال رادیویی
    \item \texttt{node\_id (BigIntegerField)}: شناسه Node
\end{itemize}

\subsubsection{SignalTest4G}
\begin{itemize}
    \item \texttt{user (ForeignKey → User)}
    \item \texttt{tac (IntegerField)}: کد منطقه تکنولوژی LTE
    \item \texttt{rsrp (FloatField)}: قدرت سیگنال LTE
    \item \texttt{rsrq (FloatField, optional)}: کیفیت سیگنال LTE
    \item \texttt{node\_id (BigIntegerField)}
\end{itemize}

\subsubsection{SignalTest5G}
مشابه 4G، شامل \texttt{tac}, \texttt{rsrp}, \texttt{rsrq}, \texttt{node\_id}

\section{Serializerها}
\begin{itemize}
    \item \texttt{SignalTest2GSerializer, SignalTest3GSerializer, SignalTest4GSerializer, SignalTest5GSerializer}
    \begin{itemize}
        \item نقش: تبدیل داده‌های مدل به JSON و اعتبارسنجی داده‌های ورودی
        \item فیلد \texttt{user} فقط خواندنی است و هنگام POST از کاربر جاری پر می‌شود
        \item تمام فیلدهای دیگر بر اساس مدل هستند (\texttt{fields = '\_all\_'}).
    \end{itemize}
\end{itemize}

\section{view}
\subsection{UnifiedSignalTestView (APIView)}
\texttt{POST /cellinfo/signal/}
\begin{itemize}
    \item عملکرد: ثبت یک رکورد سیگنال جدید
    \item احراز هویت: الزامی (\texttt{IsAuthenticated})
    \item ورودی: JSON شامل فیلدهای مدل مرتبط با تکنولوژی
\end{itemize}

جریان اتفاقات کد در \texttt{POST}
\begin{enumerate}
    \item دریافت داده‌ها از کاربر
    \item انتخاب Serializer مناسب بر اساس تکنولوژی
    \item اعتبارسنجی داده‌ها توسط Serializer
    \item ذخیره داده‌ها در دیتابیس و اختصاص \texttt{user} به کاربر جاری
    \item برگرداندن Response موفق (201 Created) یا خطا (400 Bad Request)
\end{enumerate}

مثال \texttt{POST 4G}
\begin{lstlisting}[language=json]
{
  "technology": "LTE",
  "timestamp": "2025-08-21T12:00:00Z",
  "latitude": 52.37,
  "longitude": 4.89,
  "plmn_id": "12345",
  "cell_id": 67890,
  "tac": 101,
  "rsrp": -85.0,
  "rsrq": -10.0,
  "node_id": 5555
}
\end{lstlisting}

Response Success 201
\begin{lstlisting}[language=json]
{
  "id": 1,
  "user": 2,
  "technology": "LTE",
  "timestamp": "2025-08-21T12:00:00Z",
  "latitude": 52.37,
  "longitude": 4.89,
  "plmn_id": "12345",
  "cell_id": 67890,
  "tac": 101,
  "rsrp": -85.0,
  "rsrq": -10.0,
  "node_id": 5555
}
\end{lstlisting}

Response Fail 400
\begin{lstlisting}[language=json]
{"error": "Invalid or missing technology field"}
\end{lstlisting}

\subsection{GET /cellinfo/signal/}
\begin{itemize}
    \item عملکرد: بازیابی داده‌ها با فیلترهای اختیاری
    \item احراز هویت: الزامی
    \item پارامترها: \texttt{technology}, \texttt{start}, \texttt{end}, \texttt{client\_id}, \texttt{page}, \texttt{page\_size}
\end{itemize}

جریان اتفاقات کد در \texttt{GET}
\begin{enumerate}
    \item خواندن پارامترهای فیلتر از URL
    \item انتخاب مدل و Serializer مناسب بر اساس تکنولوژی
    \item اعمال محدودیت دسترسی:
    \begin{itemize}
        \item کاربران عادی → فقط داده‌های خودشان
        \item ادمین → همه داده‌ها، با امکان فیلتر \texttt{client\_id}
    \end{itemize}
    \item اعمال فیلتر زمانی (\texttt{start} و \texttt{end})
    \item صفحه‌بندی داده‌ها (Pagination)
    \item سریالایز کردن داده‌ها و برگرداندن Response
    \item مدیریت خطا در صورت عدم تعیین یا نادرست بودن \texttt{technology}
\end{enumerate}

مثال \texttt{GET} کاربر
\begin{lstlisting}[language=json]
GET /cellinfo/signal/?technology=LTE&page=1&page_size=2
{
  "count": 5,
  "num_pages": 3,
  "current_page": 1,
  "results": [
    {"id": 1, "user": 2, "technology": "LTE", ...},
    {"id": 2, "user": 2, "technology": "LTE", ...}
  ]
}
\end{lstlisting}

مثال \texttt{GET} ادمین با \texttt{client\_id}
\begin{lstlisting}[language=json]
GET /cellinfo/signal/?technology=LTE&client_id=2&page=1
\end{lstlisting}
\begin{itemize}
    \item ادمین می‌تواند داده همه کاربران را ببیند
    \item با \texttt{client\_id} فقط داده کاربر مشخص شده را می‌گیرد
\end{itemize}

Response Fail 400
\begin{lstlisting}[language=json]
{"error": "Missing or invalid technology"}
\end{lstlisting}

\section{Tests API}
Tests API برای ثبت و بازیابی تست‌های شبکه کاربران طراحی شده است. تست‌ها شامل:
\begin{itemize}
    \item \textbf{PingTest:} زمان پاسخ Ping
    \item \textbf{DNSTest:} زمان پاسخ DNS
    \item \textbf{WebResponseTest:} زمان پاسخ وب
    \item \textbf{HTTPUploadTest / HTTPDownloadTest:} سرعت آپلود و دانلود HTTP
    \item \textbf{SMSTest:} زمان ارسال و دریافت پیامک
\end{itemize}

\section{ویژگی‌ها}
\begin{itemize}
    \item \textbf{احراز هویت:} تمام ویوها \texttt{IsAuthenticated} هستند
    \item \textbf{کاربران عادی:} فقط داده‌های خودشان را می‌بینند
    \item \textbf{ادمین:} می‌تواند داده همه کاربران را مشاهده کند و با \texttt{client\_id} فیلتر کند
    \item \textbf{فیلترها:} \texttt{start}, \texttt{end}, \texttt{client\_id}, \texttt{page}, \texttt{page\_size}
    \item \textbf{Pagination:} نتایج صفحه‌بندی شده و شامل تعداد کل، تعداد صفحات، صفحه جاری و لیست نتایج
\end{itemize}

\section{مدل‌ها}

\subsection{PingTest}
\begin{itemize}
    \item \texttt{user:} کاربری که تست را ثبت کرده
    \item \texttt{timestamp:} زمان انجام تست
    \item \texttt{ping\_response\_time:} زمان پاسخ Ping به میلی‌ثانیه
\end{itemize}

\subsection{DNSTest}
\begin{itemize}
    \item مشابه \texttt{PingTest}
    \item \texttt{dns\_response\_time:} زمان پاسخ DNS به میلی‌ثانیه
\end{itemize}

\subsection{WebResponseTest}
\begin{itemize}
    \item \texttt{user:} کاربر ثبت‌کننده
    \item \texttt{timestamp:} زمان انجام تست
    \item \texttt{web\_response\_time:} زمان پاسخ وب به میلی‌ثانیه
\end{itemize}

\subsection{HTTPUploadTest / HTTPDownloadTest}
\begin{itemize}
    \item \texttt{user:} کاربر ثبت‌کننده
    \item \texttt{timestamp:} زمان انجام تست
    \item \texttt{upload\_rate / download\_rate:} سرعت آپلود یا دانلود به Mbps
\end{itemize}

\subsection{SMSTest}
\begin{itemize}
    \item \texttt{user:} کاربر ثبت‌کننده
    \item \texttt{timestamp\_sent:} زمان ارسال پیامک
    \item \texttt{timestamp\_delivery:} زمان دریافت پیامک
    \item \texttt{delivery\_duration:} مدت زمان تحویل پیامک به ثانیه
    \item \texttt{message\_content:} متن پیامک
\end{itemize}

\section{Serializerها}
تمام Serializerها:
\begin{itemize}
    \item فیلد \texttt{user} فقط خواندنی است
    \item اعتبارسنجی داده‌های ورودی برای POST
\end{itemize}

نام Serializerها:
\begin{itemize}
    \item \texttt{PingTestSerializer, DNSTestSerializer, WebResponseTestSerializer, HTTPUploadTestSerializer, HTTPDownloadTestSerializer, SMSTestSerializer}
\end{itemize}

\section{view}

تمام ویوهای GET از \texttt{FilteredListMixin} استفاده می‌کنند.
\begin{itemize}
    \item این Mixin مسئول فیلتر کردن QuerySet، صفحه‌بندی و سریالایز داده‌ها است.
    \item مزیت: کد ویو تمیزتر و مشترک بین تمام تست‌ها می‌شود و مدیریت فیلترها یکجا انجام می‌شود.
\end{itemize}

\subsection{POST}
\begin{itemize}
    \item ثبت رکورد جدید تست
    \item جریان کد:
    \begin{enumerate}
        \item دریافت JSON ورودی
        \item سریالایز داده‌ها و اعتبارسنجی
        \item ذخیره داده‌ها و اختصاص \texttt{user} به کاربر جاری
        \item Response موفق (201 Created) یا خطا (400 Bad Request)
    \end{enumerate}
\end{itemize}

\subsection{GET}
\begin{itemize}
    \item بازیابی داده‌ها با فیلتر اختیاری
    \item جریان کد (داخل \texttt{FilteredListMixin}):
    \begin{enumerate}
        \item خواندن پارامترهای URL: \texttt{start}, \texttt{end}, \texttt{client\_id}, \texttt{page}, \texttt{page\_size}
        \item اعمال محدودیت دسترسی:
        \begin{itemize}
            \item کاربران عادی → فقط داده‌های خود
            \item ادمین → همه داده‌ها، امکان فیلتر \texttt{client\_id}
        \end{itemize}
        \item فیلتر زمانی (\texttt{timestamp} یا \texttt{timestamp\_sent} برای SMS)
        \item صفحه‌بندی داده‌ها
        \item سریالایز و بازگشت Response
    \end{enumerate}
\end{itemize}

\section{نمونه‌ها (ورودی و خروجی)}

\subsection{PingTest}
\textbf{POST}
\begin{lstlisting}[language=json]
{
  "timestamp": "2025-08-21T12:00:00Z",
  "ping_response_time": 25.3
}
\end{lstlisting}

Response Success 201
\begin{lstlisting}[language=json]
{
  "id": 1,
  "user": 2,
  "timestamp": "2025-08-21T12:00:00Z",
  "ping_response_time": 25.3
}
\end{lstlisting}

\textbf{GET}
\begin{lstlisting}[language=json]
GET /tests/ping/?start=2025-08-21T00:00:00Z&end=2025-08-21T23:59:59Z&page=1&page_size=10
{
  "count": 25,
  "num_pages": 3,
  "current_page": 1,
  "results": [
    {"id": 1, "user": 2, "timestamp": "2025-08-21T12:00:00Z", "ping_response_time": 25.3}
  ]
}
\end{lstlisting}

\subsection{DNSTest}
\textbf{POST}
\begin{lstlisting}[language=json]
{
  "timestamp": "2025-08-21T12:00:00Z",
  "dns_response_time": 50.2
}
\end{lstlisting}

Response Success 201
\begin{lstlisting}[language=json]
{
  "id": 1,
  "user": 2,
  "timestamp": "2025-08-21T12:00:00Z",
  "dns_response_time": 50.2
}
\end{lstlisting}

\textbf{GET}
\begin{lstlisting}[language=json]
GET /tests/dns/?start=2025-08-21T00:00:00Z&end=2025-08-21T23:59:59Z
Response Success 200
{
  "count": 10,
  "num_pages": 1,
  "current_page": 1,
  "results": [
    {"id": 1, "user": 2, "timestamp": "2025-08-21T12:00:00Z", "dns_response_time": 50.2}
  ]
}
\end{lstlisting}

\subsection{WebResponseTest}
\textbf{POST}
\begin{lstlisting}[language=json]
{
  "timestamp": "2025-08-21T12:00:00Z",
  "web_response_time": 120.5
}
\end{lstlisting}

Response Success 201
\begin{lstlisting}[language=json]
{
  "id": 1,
  "user": 2,
  "timestamp": "2025-08-21T12:00:00Z",
  "web_response_time": 120.5
}
\end{lstlisting}

\textbf{GET}
\begin{lstlisting}[language=json]
GET /tests/web/?start=2025-08-21T00:00:00Z&end=2025-08-21T23:59:59Z
Response Success 200
{
  "count": 8,
  "num_pages": 1,
  "current_page": 1,
  "results": [
    {"id": 1, "user": 2, "timestamp": "2025-08-21T12:00:00Z", "web_response_time": 120.5}
  ]
}
\end{lstlisting}
\section{Threshold API}
برای مدیریت پارامترها و سطح‌های آستانه (Threshold) شبکه طراحی شده است. این آستانه‌ها به کاربر و ادمین اجازه می‌دهند تا کیفیت و کمیت سیگنال شبکه (2G/3G/4G/5G) را بررسی کنند و سطوح رنگ‌بندی شده برای هشدار یا نمایش وضعیت تنظیم کنند.

\section{ویژگی‌ها}
\begin{itemize}
    \item \textbf{احراز هویت:} تمام ویوها \texttt{IsAuthenticated} هستند
    \item \textbf{کاربران عادی:} فقط پارامترهای خودشان را مشاهده و ویرایش می‌کنند
    \item \textbf{ادمین:} می‌تواند داده همه کاربران را مشاهده کند و با \texttt{client\_id} فیلتر کند
    \item \textbf{POST:} ایجاد یا آپدیت پارامترهای Threshold همراه با سطوح آن
    \item \textbf{GET:} لیست پارامترها و سطوح آنها با امکان فیلتر
\end{itemize}

\section{مدل ها}

\subsection{ThresholdParameter}
\begin{itemize}
    \item \texttt{user:} کاربری که این پارامتر را تنظیم کرده
    \item \texttt{name:} نام پارامتر (مثلاً "Signal Strength")
    \item \texttt{technology:} نوع شبکه (2G/3G/4G/5G)
    \item \texttt{signal\_type:} نوع سیگنال (quantity یا quality)
    \item \texttt{Relationship:} هر پارامتر می‌تواند چند ThresholdLevel داشته باشد
\end{itemize}

\subsection{ThresholdLevel}
\begin{itemize}
    \item \texttt{parameter:} پارامتر مربوطه
    \item \texttt{level:} شماره سطح (مثلاً 1، 2، 3)
    \item \texttt{color:} رنگ مربوط به سطح (مثلاً "green")
    \item \texttt{min\_value:} حداقل مقدار این سطح
    \item \texttt{max\_value:} حداکثر مقدار این سطح
\end{itemize}

\section{Serializerها}

\subsection{Input Serializerها}
\begin{itemize}
    \item \texttt{ThresholdLevelInputSerializer:} برای هر سطح
    \item \texttt{ThresholdParamInputSerializer:} شامل نام، نوع سیگنال و لیست سطوح
    \item \texttt{UnifiedThresholdInputSerializer:} شامل تکنولوژی و پارامترهای Threshold
\end{itemize}

\subsection{Output Serializerها}
\begin{itemize}
    \item \texttt{ThresholdLevelSerializer:} برای نمایش سطح
    \item \texttt{ThresholdParameterSerializer:} نمایش پارامتر و لیست سطوح مرتبط
\end{itemize}

\section{view}

\subsection{ThresholdCreateView (POST)}
\begin{itemize}
    \item ثبت یا آپدیت پارامترهای Threshold
    \item جریان کد:
    \begin{enumerate}
        \item دریافت JSON ورودی با تکنولوژی و پارامترها
        \item اعتبارسنجی ورودی
        \item بررسی حداقل 3 سطح برای هر پارامتر
        \item اگر پارامتر قبلاً وجود داشته باشد → حذف سطوح قدیمی
        \item ایجاد یا آپدیت سطح‌ها (\texttt{ThresholdLevel})
        \item Response موفق (201 Created) یا خطا (400 Bad Request)
    \end{enumerate}
\end{itemize}

\textbf{POST ورودی نمونه}
\begin{lstlisting}[language=json]
{
  "technology": "4G",
  "parameters": [
    {
      "name": "Signal Strength",
      "signal_type": "quantity",
      "levels": [
        {"level": 1, "color": "red", "min": 0, "max": 30},
        {"level": 2, "color": "yellow", "min": 30, "max": 70},
        {"level": 3, "color": "green", "min": 70, "max": 100}
      ]
    }
  ]
}
\end{lstlisting}

Response Success 201
\begin{lstlisting}[language=json]
{
  "message": "Thresholds created/updated successfully."
}
\end{lstlisting}

Response Fail 400 (سطح کمتر از 3)
\begin{lstlisting}[language=json]
{
  "error": "Parameter 'Signal Strength' must have at least 3 levels."
}
\end{lstlisting}

\subsection{ThresholdListView (GET)}
\begin{itemize}
    \item نمایش پارامترهای Threshold و سطوح آن‌ها
    \item فیلترها: \texttt{technology}, \texttt{name}, \texttt{client\_id}
    \item کاربران عادی: فقط پارامترهای خودشان
    \item ادمین: می‌تواند همه پارامترها را ببیند و با \texttt{client\_id} فیلتر کند
    \item Pagination در این ویو پیش‌فرض استفاده نشده، ولی می‌توان اضافه کرد
\end{itemize}

\textbf{GET نمونه}
\begin{lstlisting}[language=json]
GET /thresholds/?technology=4G&name=Signal%20Strength
\end{lstlisting}

Response Success 200
\begin{lstlisting}[language=json]
[
  {
    "user_id": 2,
    "name": "Signal Strength",
    "technology": "4G",
    "signal_type": "quantity",
    "levels": [
      {"level": 1, "color": "red", "min_value": 0, "max_value": 30},
      {"level": 2, "color": "yellow", "min_value": 30, "max_value": 70},
      {"level": 3, "color": "green", "min_value": 70, "max_value": 100}
    ]
  }
]
\end{lstlisting}

\section{نمونه‌ها (ورودی و خروجی)}

\subsection{ThresholdCreateView (POST)}
\textbf{POST}
\begin{lstlisting}[language=json]
{
  "technology": "4G",
  "parameters": [
    {
      "name": "Signal Strength",
      "signal_type": "quantity",
      "levels": [
        {"level": 1, "color": "red", "min": 0, "max": 30},
        {"level": 2, "color": "yellow", "min": 30, "max": 70},
        {"level": 3, "color": "green", "min": 70, "max": 100}
      ]
    }
  ]
}
\end{lstlisting}

Response Success 201
\begin{lstlisting}[language=json]
{
  "message": "Thresholds created/updated successfully."
}
\end{lstlisting}

Response Fail 400
\begin{lstlisting}[language=json]
{
  "error": "Parameter 'Signal Strength' must have at least 3 levels."
}
\end{lstlisting}

\subsection{ThresholdListView (GET)}
\textbf{GET}
\begin{lstlisting}[language=json]
GET /thresholds/?technology=4G&name=Signal%20Strength
\end{lstlisting}

Response Success 200
\begin{lstlisting}[language=json]
[
  {
    "user_id": 2,
    "name": "Signal Strength",
    "technology": "4G",
    "signal_type": "quantity",
    "levels": [
      {"level": 1, "color": "red", "min_value": 0, "max_value": 30},
      {"level": 2, "color": "yellow", "min_value": 30, "max_value": 70},
      {"level": 3, "color": "green", "min_value": 70, "max_value": 100}
    ]
  }
]
\end{lstlisting}


\chapter{ \lr{Polaris Client}}

\section{ \lr{Web Application}}

\section{ \lr{Android Mobile Client}}

\chapter{تحلیل و نتجه گیری}
 
\end{document}



