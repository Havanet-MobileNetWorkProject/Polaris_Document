\documentclass{report}
\usepackage{ptext}
\usepackage{lipsum}
\usepackage{graphicx}
\usepackage{ptext}

\input{Boostan-UserManual}

\input{Chapters/BWords}
\input{Chapters/abbre}

\title{گزارش پروژه نهایی درس شبکه های تلفن همراه}
\type{گزارش }
\author{زهرا دهقان\\اسماء حمید\\فاطمه شرح دهی مقدم}

\logofile{Pic/logo}


\begin{document}

\pagenumbering{gobble}
\Godpage
\maketitle
\pagenumbering{arabic}
\tableofcontents


\chapter{مقدمه}








\chapter{ \lr{Polaris Server}}

\section{\lr{Authentication}}

\subsection{\lr{Register API} (ثبت‌نام کاربر)}
\textbf{مدل \lr{(User Model)}} \\
مدل کاربر برای سامانه Polaris به شکل زیر طراحی شده است:

\begin{itemize}
  \item \lr{phone}: شماره تلفن کاربر (یونیک و به‌عنوان نام کاربری استفاده می‌شود).
  \item \lr{role}: نقش کاربر که می‌تواند \lr{user} یا \lr{admin} باشد (پیش‌فرض: \lr{user}).
  \item \lr{is\_active}: تعیین فعال بودن کاربر.
  \item \lr{is\_staff}: برای تشخیص دسترسی مدیریتی.
\end{itemize}

کاربران عادی نقش \lr{user} دارند و مدیران (\lr{superuser}) نقش \lr{admin}. \\
همچنین یک \lr{UserManager} پیاده‌سازی شده تا:
\begin{itemize}
  \item تابع \lr{create\_user}: کاربر عادی بسازد.
  \item تابع \lr{create\_superuser}: ادمین بسازد.
\end{itemize}


\begin{lstlisting}[language=python]
{
  class UserManager(BaseUserManager):
    def create_user(self, phone, password=None, **extra_fields):
        if not phone:
            raise ValueError("Phone number is required")
        user = self.model(phone=phone, **extra_fields)
        user.set_password(password)
        user.save(using=self._db)
        return user

    def create_superuser(self, phone, password=None, **extra_fields):
        extra_fields.setdefault('is_staff', True)
        extra_fields.setdefault('is_superuser', True)
        extra_fields.setdefault('role', 'admin')
        return self.create_user(phone, password, **extra_fields)

class User(AbstractBaseUser, PermissionsMixin):
    ROLE_CHOICES = (
        ('user', 'User'),
        ('admin', 'Admin'),
    )

    phone = models.CharField(max_length=15, unique=True)
    role = models.CharField(max_length=10, choices=ROLE_CHOICES, default='user')
    is_active = models.BooleanField(default=True)
    is_staff = models.BooleanField(default=False)

    objects = UserManager()

    USERNAME_FIELD = 'phone'
    REQUIRED_FIELDS = []

    def __str__(self):
        return self.phone

}
\end{lstlisting}


\textbf{Serializer (RegisterSerializer)} \\
کلاس \lr{RegisterSerializer} برای اعتبارسنجی داده‌های ورودی ثبت‌نام استفاده می‌شود:
\begin{itemize}
  \item فقط دو فیلد دریافت می‌کند: \lr{phone} و \lr{password}.
  \item \lr{password} فقط نوشتنی (\lr{write\_only}) است.
  \item تابع \lr{create}: از متد \lr{create\_user} در \lr{UserManager} استفاده می‌کند.
\end{itemize}

\begin{lstlisting}[language=python ]
{
  class RegisterSerializer(serializers.ModelSerializer):
    class Meta:
        model = User
        fields = ['phone', 'password']
        extra_kwargs = {'password': {'write_only': True}}

    def create(self, validated_data):
        return User.objects.create_user(**validated_data)

}
\end{lstlisting}

\textbf{View (RegisterView)} \\
کلاس \lr{RegisterView} یک \lr{APIView} است که درخواست‌های POST را پردازش می‌کند:
\begin{itemize}
  \item داده‌های ورودی توسط \lr{RegisterSerializer} بررسی می‌شود.
  \item اگر معتبر بود: کاربر ساخته می‌شود و توکن‌های JWT صادر می‌گردد.
  \item خروجی شامل توکن‌ها + اطلاعات کاربر است.
\end{itemize}

\begin{lstlisting}[language=python ]
{
  class RegisterView(APIView):
    def post(self, request):
        serializer = RegisterSerializer(data=request.data)
        if serializer.is_valid():
            user = serializer.save()
            refresh = RefreshToken.for_user(user)
            return Response({
                "refresh": str(refresh),
                "access": str(refresh.access_token),
                "user": UserSerializer(user).data
            }, status=201)
        return Response(serializer.errors, status=400)

}
\end{lstlisting}

\textbf{ورودی \lr{(POST /auth/signup/)}}:
\begin{lstlisting}[language=json]
{
  "phone": "09123456789",
  "password": "test1234"
}
\end{lstlisting}

\textbf{خروجی موفق \lr{(201)}}:
\begin{lstlisting}[language=json]
{
  "refresh": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1...",
  "access": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1...",
  "user": {
    "id": 1,
    "phone": "09123456789",
    "role": "user"
  }
}
\end{lstlisting}

\textbf{خروجی ناموفق \lr{(400)}}:
\begin{lstlisting}[language=json]
{
  "phone": ["This field must be unique."]
}
\end{lstlisting}
\subsubsection{Post-Save Signal (ایجاد آستانه‌های پیش‌فرض بعد از ثبت‌نام)}

پس از ثبت‌نام هر کاربر جدید، یک سیگنال \lr{post\_save} در جنگو اجرا می‌شود. این سیگنال باعث می‌شود که به‌طور خودکار مجموعه‌ای از \lr{ThresholdParameter} و \lr{ThresholdLevel} برای کاربر ایجاد گردد.

\textbf{کلیت Threshold} \\
جزئیات کامل ساختار و کاربرد \lr{Threshold}ها در فصل مربوط به \lr{Thresholds API} توضیح داده خواهد شد. 
در این بخش تنها نحوه‌ی ایجاد پیش‌فرض‌ها هنگام ثبت‌نام بیان می‌شود.

\textbf{Signal (create\_default\_thresholds)} \\
این تابع سیگنال پس از ذخیره‌ی یک کاربر (\lr{User}) اجرا می‌شود:
\begin{itemize}
  \item بررسی می‌کند که آیا کاربر تازه ساخته شده است و نقش او \lr{user} باشد.
  \item اگر درست باشد، بر اساس \lr{default\_thresholds} برای هر فناوری (\lr{2G}, \lr{3G}, \lr{4G}, \lr{5G}) پارامترها ساخته می‌شوند.
  \item برای هر پارامتر چندین سطح (\lr{ThresholdLevel}) با بازه مقادیر و رنگ مشخص ایجاد می‌شود.
\end{itemize}



\textbf{مقادیر پیش‌فرض (\lr{default\_thresholds})} \\
این مقادیر برای هر فناوری از قبل تعریف شده‌اند.

\textbf{نمونه برای \lr{2G}}:
\begin{lstlisting}[language=json]
"2G": [
  {
    "name": "rxlev",
    "signal_type": "quantity",
    "levels": [
      {"level": 1, "color": "#FF0000", "min": -110, "max": -100},
      {"level": 2, "color": "#FFFF00", "min": -100, "max": -80},
      {"level": 3, "color": "#008000", "min": -80, "max": -50}
    ]
  }
]
\end{lstlisting}

برای سایر فناوری‌ها (\lr{3G}، \lr{4G}، \lr{5G}) نیز پارامترهایی مانند \lr{rscp}، \lr{rsrp} و \lr{rsrq} تعریف شده‌اند که هرکدام دارای سطوح رنگی مختلف هستند. 

به این ترتیب، هر کاربر جدید بلافاصله پس از ثبت‌نام، یک مجموعه‌ی اولیه از آستانه‌های سنجش کیفیت و کمیت سیگنال را در اختیار خواهد داشت.



\subsection{Login API (ورود کاربر)}
\textbf{View \lr{(LoginView)}} \\
\begin{itemize}
  \item درخواست POST می‌گیرد.
  \item شماره تلفن و رمز عبور را بررسی می‌کند.
  \item در صورت معتبر بودن، توکن‌های JWT صادر می‌کند.
  \item اطلاعات کاربر بازگردانده می‌شود.
\end{itemize}

\textbf{ورودی \lr{(POST /auth/login/)}}:
\begin{lstlisting}[language=json]
{
  "phone": "09123456789",
  "password": "test1234"
}
\end{lstlisting}

\textbf{خروجی موفق \lr{(200)}}:
\begin{lstlisting}[language=json]
{
  "refresh": "eyJ0eXAiOiJKV1QiLCJh...",
  "access": "eyJ0eXAiOiJKV1QiLCJh...",
  "user": {
    "id": 1,
    "phone": "09123456789",
    "role": "user"
  }
}
\end{lstlisting}

\textbf{خروجی ناموفق \lr{(401)}}:
\begin{lstlisting}[language=json]
{
  "error": "Invalid credentials"
}
\end{lstlisting}


\subsection{\lr{Logout API} (خروج کاربر)}
\textbf{View (LogoutView)} \\
\begin{itemize}
  \item درخواست POST دریافت می‌کند.
  \item کاربر باید توکن \lr{refresh} را ارسال کند.
  \item توکن بلاک‌لیست می‌شود.
\end{itemize}

\textbf{ورودی \lr{(POST /auth/logout/)}}:
\begin{lstlisting}[language=json]
{
  "refresh": "eyJ0eXAiOiJKV1QiLCJh..."
}
\end{lstlisting}

\textbf{خروجی موفق \lr{(205)}}: (بدون بدنه) \\
\textbf{خروجی ناموفق \lr{(400)}}: (بدون بدنه)


\subsection{\lr{Profile API} (نمایه کاربر)}
\textbf{Serializer (UserSerializer)} \\
برای نمایش اطلاعات کاربر از \lr{UserSerializer} استفاده می‌شود (شامل \lr{id}, \lr{phone}, \lr{role}).

\textbf{View (ProfileView)} \\
\begin{itemize}
  \item درخواست GET دریافت می‌کند.
  \item نیاز به احراز هویت دارد.
  \item اطلاعات کاربر لاگین‌شده بازگردانده می‌شود.
\end{itemize}

\textbf{ورودی \lr{(GET /auth/profile/)}}:   \\

\textbf{خروجی موفق \lr{(200)}}:
\begin{lstlisting}[language=json]
{
  "id": 1,
  "phone": "09123456789",
  "role": "user"
}
\end{lstlisting}

\textbf{خروجی ناموفق \lr{(401)}}:
\begin{lstlisting}[language=json]
{
  "detail": "Authentication credentials were not provided."
}
\end{lstlisting}

\section{\lr{CellInfo API}}
برای ثبت و دریافت اطلاعات سیگنال سلولی کاربران طراحی شده است. این API انواع شبکه‌ها را پشتیبانی می‌کند: \lr{2G}, \lr{3G}, \lr{4G}, \lr{5G}. کاربران باید احراز هویت شده باشند (\texttt{IsAuthenticated}) تا بتوانند داده‌ها را ارسال یا دریافت کنند.

\section{دسته‌بندی کاربران}
\begin{itemize}
    \item \textbf{کاربران عادی:} فقط داده‌های خودشان را می‌بینند.
    \item \textbf{ادمین‌ها:} می‌توانند داده همه کاربران را مشاهده کنند و در صورت نیاز با پارامتر \texttt{client\_id} فیلتر کنند.
\end{itemize}

\section{مدل‌ها}
تمام مدل‌ها از \texttt{BaseSignalTest} ارث‌بری می‌کنند.

\subsection{BaseSignalTest}
\begin{itemize}
    \item \texttt{timestamp (DateTimeField)}: زمان ثبت سیگنال
    \item \texttt{technology (CharField)}: نوع تکنولوژی سلولی. گزینه‌ها: 'GSM', 'GPRS', 'EDGE', 'UMTS', 'HSPA', 'HSPA+', 'LTE', 'LTE-Adv', \lr{'5G'}
    \item \texttt{latitude} و \texttt{longitude (FloatField)}: موقعیت جغرافیایی سیگنال
    \item \texttt{plmn\_id (CharField)}: شناسه شبکه تلفن همراه
    \item \texttt{cell\_id (BigIntegerField)}: شناسه سلول
    \item \texttt{arfcn \lr{(IntegerField, optional)}}: فرکانس رادیویی
    \item \texttt{band \leftarrow{(IntegerField, optional)}}: باند فرکانسی
\end{itemize}

\subsubsection{Property Generation}
\begin{itemize}
    \item \textbf{\lr{2G}:} \lr{GSM, GPRS, EDGE}
    \item \textbf{\lr{3G}:} \lr{UMTS, HSPA, HSPA+}
    \item \textbf{\lr{4G}:} \lr{LTE, LTE-Adv}
    \item \textbf{\lr{5G}:} \lr{5G}
    \item \textbf{\lr{Unknown}:} سایر مقادیر
\end{itemize}

\subsection{مدل‌های اختصاصی هر نسل}

\subsubsection{\lr{SignalTest2G}}
\begin{itemize}
    \item ارث‌بری از \texttt{BaseSignalTest}
    \item \texttt{\lr{{user (ForeignKey → User)}}}: کاربر ثبت‌کننده
    \item \texttt{\lr{lac (IntegerField)}}: کد منطقه سلولی
    \item \texttt{\lr{rxlev (FloatField, optional)}}: قدرت سیگنال
\end{itemize}

\subsubsection{\lr{SignalTest3G}}
\begin{itemize}
    \item \texttt{\lr{user (ForeignKey → User)}}: کاربر ثبت‌کننده
    \item \texttt{\lr{lac (IntegerField)}}: کد منطقه سلولی
    \item \texttt{\lr{rscp (FloatField)}}: قدرت سیگنال رادیویی
    \item \texttt{\lr{node\_id (BigIntegerField)}}: شناسه Node
\end{itemize}

\subsubsection{SignalTest4G}
\begin{itemize}
    \item \texttt{\lr{user (ForeignKey → User)}}
    \item \texttt{\lr{tac (IntegerField)}}: کد منطقه تکنولوژی LTE
    \item \texttt{\lr{rsrp (FloatField)}}: قدرت سیگنال LTE
    \item \texttt{\lr{rsrq (FloatField, optional)}}: کیفیت سیگنال LTE
    \item \texttt{\lr{node\_id (BigIntegerField)}}
\end{itemize}

\subsubsection{\lr{SignalTest5G}}
مشابه \lr{4G} شامل \texttt{tac}, \texttt{rsrp}, \texttt{rsrq}, \texttt{node\_id}

\section{Serilizers}
\begin{itemize}
    \item \texttt{SignalTest2GSerializer, SignalTest3GSerializer, SignalTest4GSerializer, SignalTest5GSerializer}
    \begin{itemize}
        \item نقش: تبدیل داده‌های مدل به JSON و اعتبارسنجی داده‌های ورودی
        \item فیلد \texttt{user} فقط خواندنی است و هنگام POST از کاربر جاری پر می‌شود
        \item تمام فیلدهای دیگر بر اساس مدل هستند (\texttt{\lr{fields = '\_all\_'}}).
    \end{itemize}
\end{itemize}

\section{view}
\subsection{UnifiedSignalTestView (APIView)}
\texttt{\lr{POST /cellinfo/signal/}}
\begin{itemize}
    \item عملکرد: ثبت یک رکورد سیگنال جدید
    \item احراز هویت: الزامی (\texttt{IsAuthenticated})
    \item ورودی: JSON شامل فیلدهای مدل مرتبط با تکنولوژی
\end{itemize}

  توضیحات کد   \texttt{POST}
\begin{enumerate}
    \item دریافت داده‌ها از کاربر
    \item انتخاب Serializer مناسب بر اساس تکنولوژی
    \item اعتبارسنجی داده‌ها توسط Serializer
    \item ذخیره داده‌ها در دیتابیس و اختصاص \texttt{user} به کاربر جاری
    \item برگرداندن Response موفق \lr{(201 Created)} یا خطا \lr{(400 Bad Request)}
\end{enumerate}

مثال ورودی   \texttt{\lr{POST \cellinfo\signal 4G}}
\begin{lstlisting}[language=json]
{
  "technology": "LTE",
  "timestamp": "2025-08-21T12:00:00Z",
  "latitude": 52.37,
  "longitude": 4.89,
  "plmn_id": "12345",
  "cell_id": 67890,
  "tac": 101,
  "rsrp": -85.0,
  "rsrq": -10.0,
  "node_id": 5555
}
\end{lstlisting}

\lr{Response Success 201}
\begin{lstlisting}[language=json]
{
  "id": 1,
  "user": 2,
  "technology": "LTE",
  "timestamp": "2025-08-21T12:00:00Z",
  "latitude": 52.37,
  "longitude": 4.89,
  "plmn_id": "12345",
  "cell_id": 67890,
  "tac": 101,
  "rsrp": -85.0,
  "rsrq": -10.0,
  "node_id": 5555
}
\end{lstlisting}



\subsection{\lr{GET /cellinfo/signal/}}
\begin{itemize}
    \item عملکرد: بازیابی داده‌ها با فیلترهای اختیاری
    \item احراز هویت: الزامی
    \item پارامترها: \texttt{technology}, \texttt{start}, \texttt{end}, \texttt{client\_id}, \texttt{page}, \texttt{page\_size}
\end{itemize}

   توضیحات کد  \texttt{GET}
\begin{enumerate}
    \item خواندن پارامترهای فیلتر از URL
    \item انتخاب مدل و Serializer مناسب بر اساس تکنولوژی
    \item اعمال محدودیت دسترسی:
    \begin{itemize}
        \item کاربران عادی  فقط به داده های مربوط به خود دسترسی دارند  
        \item ادمین به  همه داده‌ها، با امکان فیلتر دسترسی دارند  \texttt{client\_id}
    \end{itemize}
    \item اعمال فیلتر زمانی (\texttt{start} و \texttt{end})
    \item صفحه‌بندی داده‌ها (Pagination)
    \item سریالایز کردن داده‌ها و برگرداندن Response
    \item مدیریت خطا در صورت عدم تعیین یا نادرست بودن \texttt{technology}
\end{enumerate}

مثال \texttt{\lr{GET /cellinfo/signal/?technology=LTE&page=1&page_size=2}} کاربر
\begin{lstlisting}[language=json]
{
  "count": 5,
  "num_pages": 3,
  "current_page": 1,
  "results": [
    {"id": 1, "user": 2, "technology": "LTE", ...},
    {"id": 2, "user": 2, "technology": "LTE", ...}
  ]
}
\end{lstlisting}

مثال \texttt{GET} ادمین با \texttt{client\_id}
\begin{lstlisting}[language=json]
GET /cellinfo/signal/?technology=LTE&client_id=2&page=1
\end{lstlisting}
\begin{itemize}
    \item ادمین می‌تواند داده همه کاربران را ببیند
    \item با \texttt{client\_id} فقط داده کاربر مشخص شده را می‌گیرد
\end{itemize}

\section{/lr{Tests API}}
\lr{Tests API} برای ثبت و بازیابی تست‌های شبکه کاربران طراحی شده است. تست‌ها شامل:
\begin{itemize}
    \item \textbf{\lr{PingTest}:} زمان پاسخ Ping
    \item \textbf{\lr{DNSTest}:} زمان پاسخ DNS
    \item \textbf{\lr{WebResponseTest}:} زمان پاسخ وب
    \item \textbf{\lr{HTTPUploadTest / HTTPDownloadTest}:} سرعت آپلود و دانلود HTTP
    \item \textbf{\lr{SMSTest}:} زمان ارسال و دریافت پیامک
\end{itemize}

\section{ویژگی‌ها}
\begin{itemize}
    \item \textbf{احراز هویت:} تمام ویوها \texttt{IsAuthenticated} هستند
    \item \textbf{کاربران عادی:} فقط داده‌های خودشان را می‌بینند
    \item \textbf{ادمین:} می‌تواند داده همه کاربران را مشاهده کند و با \texttt{client\_id} فیلتر کند
    \item \textbf{فیلترها:} \texttt{start}, \texttt{end}, \texttt{client\_id}, \texttt{page}, \texttt{page\_size}
    \item \textbf{\lr{Pagination}:} نتایج صفحه‌بندی شده و شامل تعداد کل، تعداد صفحات، صفحه جاری و لیست نتایج
\end{itemize}

\section{مدل‌ها}

\subsection{PingTest}
\begin{itemize}
    \item \texttt{\lr{user}:} کاربری که تست را ثبت کرده
    \item \texttt{\lr{timestamp}:} زمان انجام تست
    \item \texttt{\lr{ping\_response\_time}:} زمان پاسخ Ping  
\end{itemize}

\subsection{DNSTest}
\begin{itemize}
    \item \texttt{\lr{user}:} کاربری که تست را ثبت کرده
    \item \texttt{\lr{timestamp}:} زمان انجام تست
    \item \texttt{\lr{dns\_response\_time}:} زمان پاسخ DNS  
\end{itemize}

\subsection{WebResponseTest}
\begin{itemize}
    \item \texttt{\lr{user}:} کاربری که تست را ثبت کرده 
    \item \texttt{\lr{timestamp}:} زمان انجام تست
    \item \texttt{\lr{web\_response\_time}:} زمان پاسخ وب  
\end{itemize}

\subsection{HTTPUploadTest / HTTPDownloadTest}
\begin{itemize}
    \item \texttt{\lr{user}:} کاربر ثبت‌کننده
    \item \texttt{\lr{timestamp}:} زمان انجام تست
    \item \texttt{\lr{upload\_rate / download\_rate}:} سرعت آپلود یا دانلود به Mbps
\end{itemize}

\subsection{SMSTest}
\begin{itemize}
    \item \texttt{\lr{user}:} کاربر ثبت‌کننده
    \item \texttt{\lr{timestamp\_sent}:} زمان ارسال پیامک
    \item \texttt{\lr{timestamp\_delivery}:} زمان دریافت پیامک
    \item \texttt{\lr{delivery\_duration}:} مدت زمان تحویل پیامک  
    \item \texttt{\lr{message\_content}:} متن پیامک
\end{itemize}

\section{Serializers}
تمام  Serilizer :
\begin{itemize}
    \item \texttt{\lr{PingTestSerializer, DNSTestSerializer, WebResponseTestSerializer, HTTPUploadTestSerializer, HTTPDownloadTestSerializer, SMSTestSerializer}}
\end{itemize}

\begin{itemize}
    \item فیلد \texttt{user} فقط خواندنی است
    \item اعتبارسنجی داده‌های ورودی برای POST
\end{itemize}


\section{view}

تمام ویوهای GET از \texttt{FilteredListMixin} استفاده می‌کنند.
این Mixin مسئول فیلتر کردن QuerySet، صفحه‌بندی و سریالایز داده‌ها است.

\subsection{POST}
\begin{itemize}
    \item ثبت رکورد جدید تست
    \item جریان کد:
    \begin{enumerate}
        \item دریافت JSON ورودی
        \item سریالایز داده‌ها و اعتبارسنجی
        \item ذخیره داده‌ها و اختصاص \texttt{user} به کاربر جاری
        \item Response موفق \lr{(201 Created)} یا خطا \lr{(400 Bad Request)}
    \end{enumerate}
\end{itemize}

\subsection{GET}
\begin{itemize}
    \item بازیابی داده‌ها با فیلتر اختیاری
    \item جریان کد (داخل \texttt{FilteredListMixin}):
    \begin{enumerate}
        \item خواندن پارامترهای URL: \texttt{start}, \texttt{end}, \texttt{client\_id}, \texttt{page}, \texttt{page\_size}
        \item اعمال محدودیت دسترسی:
        \begin{itemize}
            \item کاربران عادی → فقط داده‌های خود
            \item ادمین → همه داده‌ها، امکان فیلتر \texttt{client\_id}
        \end{itemize}
        \item فیلتر زمانی \texttt{timestamp} یا \texttt{timestamp\_sent} برای SMS
        \item صفحه‌بندی داده‌ها
        \item سریالایز و بازگشت Response
    \end{enumerate}
\end{itemize}

\section{نمونه‌ها (ورودی و خروجی)}

\subsection{PingTest}
\textbf{POST /tests/ping }
\begin{lstlisting}[language=json]
{
  "timestamp": "2025-08-21T12:00:00Z",
  "ping_response_time": 25.3
}
\end{lstlisting}

\lr{Response Success 201}
\begin{lstlisting}[language=json]
{
  "id": 1,
  "user": 2,
  "timestamp": "2025-08-21T12:00:00Z",
  "ping_response_time": 25.3
}
\end{lstlisting}

\textbf{GET /tests/ping/?start=2025-08-21T00:00:00Z&end=2025-08-21T23:59:59Z&page=1&page_size=10
}
\begin{lstlisting}[language=json]
{
  "count": 25,
  "num_pages": 3,
  "current_page": 1,
  "results": [
    {"id": 1, "user": 2, "timestamp": "2025-08-21T12:00:00Z", "ping_response_time": 25.3}
  ]
}
\end{lstlisting}

\subsection{DNSTest}
\textbf{POST /tests/dns/}
\begin{lstlisting}[language=json]
{
  "timestamp": "2025-08-21T12:00:00Z",
  "dns_response_time": 50.2
}
\end{lstlisting}

\lr{Response Success 201}
\begin{lstlisting}[language=json]
{
  "id": 1,
  "user": 2,
  "timestamp": "2025-08-21T12:00:00Z",
  "dns_response_time": 50.2
}
\end{lstlisting}

\textbf{GET /tests/dns/?start=2025-08-21T00:00:00Z&end=2025-08-21T23:59:59Z}
\begin{lstlisting}[language=json]

{
  "count": 10,
  "num_pages": 1,
  "current_page": 1,
  "results": [
    {"id": 1, "user": 2, "timestamp": "2025-08-21T12:00:00Z", "dns_response_time": 50.2}
  ]
}
\end{lstlisting}

\subsection{WebResponseTest}
\textbf{POST /tests/web/}
\begin{lstlisting}[language=json]
{
  "timestamp": "2025-08-21T12:00:00Z",
  "web_response_time": 120.5
}
\end{lstlisting}

\lr{Response Success 201}
\begin{lstlisting}[language=json]
{
  "id": 1,
  "user": 2,
  "timestamp": "2025-08-21T12:00:00Z",
  "web_response_time": 120.5
}
\end{lstlisting}

\textbf{GET /tests/web/?start=2025-08-21T00:00:00Z&end=2025-08-21T23:59:59Z
}
\begin{lstlisting}[language=json]
Response Success 200
{
  "count": 8,
  "num_pages": 1,
  "current_page": 1,
  "results": [
    {"id": 1, "user": 2, "timestamp": "2025-08-21T12:00:00Z", "web_response_time": 120.5}
  ]
}
\end{lstlisting}
\section{Threshold API}
برای مدیریت پارامترها و سطح‌های آستانه (Threshold) شبکه طراحی شده است. این آستانه‌ها به کاربر و ادمین اجازه می‌دهند تا کیفیت و کمیت سیگنال شبکه \lr{(2G/3G/4G/5G)} را بررسی کنند و سطوح رنگ‌بندی شده برای هشدار یا نمایش وضعیت تنظیم کنند.

\section{ویژگی‌ها}
\begin{itemize}
    \item \textbf{احراز هویت:} تمام ویوها \texttt{IsAuthenticated} هستند
    \item \textbf{کاربران عادی:} فقط پارامترهای خودشان را مشاهده و ویرایش می‌کنند
    \item \textbf{ادمین:} می‌تواند داده همه کاربران را مشاهده کند و با \texttt{client\_id} فیلتر کند
    \item \textbf{\lr{POST}:} ایجاد یا آپدیت پارامترهای Threshold همراه با سطوح آن
    \item \textbf{\lr{GET}:} لیست پارامترها و سطوح آنها با امکان فیلتر
\end{itemize}

\section{مدل ها}

\subsection{ThresholdParameter}
\begin{itemize}
    \item \texttt{\lr{user}:} کاربری که این پارامتر را تنظیم کرده
    \item \texttt{\lr{name}:} نام پارامتر 
    \item \texttt{\lr{technology}:} نوع شبکه \lr{(2G/3G/4G/5G)}
    \item \texttt{\lr{signal\_type}:} نوع سیگنال \lr{(quantity یا quality)}
    \item \texttt{\lr{Relationship}:} هر پارامتر می‌تواند چند ThresholdLevel داشته باشد
\end{itemize}

\subsection{ThresholdLevel}
\begin{itemize}
    \item \texttt{\lr{parameter}:} پارامتر مربوطه
    \item \texttt{\lr{level}:} شماره سطح (مثلاً 1، 2، 3)
    \item \texttt{\lr{color}:} رنگ مربوط به سطح (مثلاً "green")
    \item \texttt{\lr{min\_value}:} حداقل مقدار این سطح
    \item \texttt{\lr{max\_value}:} حداکثر مقدار این سطح
\end{itemize}

\section{Serializers}

\subsection{\lr{Input Serializers}}
\begin{itemize}
    \item \texttt{\lr{ThresholdLevelInputSerializer}:} برای هر سطح
    \item \texttt{\lr{ThresholdParamInputSerializer}:} شامل نام، نوع سیگنال و لیست سطوح
    \item \texttt{\lr{UnifiedThresholdInputSerializer}:} شامل تکنولوژی و پارامترهای Threshold
\end{itemize}

\subsection{\lr{Output Serializers}}
\begin{itemize}
    \item \texttt{ThresholdLevelSerializer:} برای نمایش سطح
    \item \texttt{ThresholdParameterSerializer:} نمایش پارامتر و لیست سطوح مرتبط
\end{itemize}

\section{Views}

\subsection{\lr{ThresholdCreateView (POST)}}
\begin{itemize}
    \item ثبت یا آپدیت پارامترهای Threshold
    \item جریان کد:
    \begin{enumerate}
        \item دریافت JSON ورودی با تکنولوژی و پارامترها
        \item اعتبارسنجی ورودی
        \item بررسی حداقل 3 سطح برای هر پارامتر
        \item اگر پارامتر قبلاً وجود داشته باشد → حذف سطوح قدیمی
        \item ایجاد یا آپدیت سطح‌ها (\texttt{ThresholdLevel})
        \item Response موفق \lr{(201 Created)} یا خطا \lr{(400 Bad Request)}
    \end{enumerate}
\end{itemize}

\textbf{POST /thresholds/create/ }
\begin{lstlisting}[language=json]
{
  "technology": "4G",
  "parameters": [
    {
      "name": "Signal Strength",
      "signal_type": "quantity",
      "levels": [
        {"level": 1, "color": "red", "min": 0, "max": 30},
        {"level": 2, "color": "yellow", "min": 30, "max": 70},
        {"level": 3, "color": "green", "min": 70, "max": 100}
      ]
    }
  ]
}
\end{lstlisting}

\lr{Response Success 201}
\begin{lstlisting}[language=json]
{
  "message": "Thresholds created/updated successfully."
}
\end{lstlisting}

\lr{Response Fail 400 }(سطح کمتر از 3)
\begin{lstlisting}[language=json]
{
  "error": "Parameter 'Signal Strength' must have at least 3 levels."
}
\end{lstlisting}

\subsection{ThresholdListView (GET)}
\begin{itemize}
    \item نمایش پارامترهای Threshold و سطوح آن‌ها
    \item فیلترها: \texttt{technology}, \texttt{name}, \texttt{client\_id}
    \item کاربران عادی: فقط پارامترهای خودشان
    \item ادمین: می‌تواند همه پارامترها را ببیند و با \texttt{client\_id} فیلتر کند
\end{itemize}

\textbf{GET /thresholds/?technology=4G&name=rsrp}

/lr{Response Success 200}
\begin{lstlisting}[language=json]
[
  {
    "user_id": 2,
    "name": "rsrp",
    "technology": "4G",
    "signal_type": "quantity",
    "levels": [
      {"level": 1, "color": "red", "min_value": 0, "max_value": 30},
      {"level": 2, "color": "yellow", "min_value": 30, "max_value": 70},
      {"level": 3, "color": "green", "min_value": 70, "max_value": 100}
    ]
  }
]
\end{lstlisting}



\chapter{ \lr{Polaris Client}}

\section{ \lr{Web Application}}

\section{ \lr{Android Mobile Client}}

\chapter{تحلیل و نتجه گیری}
 
\end{document}



